<!DOCTYPE html>
<html lang="en">
<head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <meta name="author" description = "Miracle King Hesed">
            <meta name="description" content="A music website. That's Pretty much all it is.">
    <title>mi-play</title>
    <link rel="stylesheet" href="./css/style.css">
    <link rel="icon" href="./img/logo.png" type="image/x-icon">
    <link rel="stylesheet" media="max-width: 450px" href="./css/min.css" />

    <style>
      

        
    </style>
</head>

<body>
    <div id="overlay"></div>
    <main class="container">
        <div class="main-section">
         <div class="screen-for-handheld">
            <div class="song-screen-container">
                            <div class="song-screen">
                <img class="top-gradient" src="./img/top_gradient.png" alt="top_gradient"/>
                        <div class="song-main-case ">
                                <div class="image-case"></div>
                            <div class="song-text-case">
                                <h4 id="title-main" class="song-title">Freedom</h4>
                                <p id="author-main" class="author">By Saturn</p>
                            </div>
                            <img class="burger" width="25" height="25" src="./img/burger.png" alt="burger"/>
                </div>
                <img class="bottom-gradient" src="./img/bottom_gradient_II.png" alt="bottom_gradient"/>
            </div>
        </div>
            </div>
            <div class="music-controls">
                <div class="music-buttons">
                    <!-- <i class="fa fa-step-backward" aria-hidden="true"></i> -->
                    <img class="backward-button" src="./img/backward-white.png" alt="backward"/>
                    <span class="play-button"><img src="./img/play-white.png" alt="play"/></span>
                    <!-- <i class="fa fa-play" aria-hidden="true"></i>   <i class="fa fa-pause" aria-hidden="true"></i> -->
                    <img class="forward-button" src="./img/forward-white.png" alt="forward"/>
                    <!-- <i class="fa fa-step-forward" aria-hidden="true"></i> -->
                </div>
                <div class="other-controls">
                    <div class="start-time">
                        <span>0:00</span>
                    </div>

                    <div class="bar-and-time-container">
                        <div id="bar"></div>
                        <div id="current-time"></div>
                      </div>

                      <div class="end-time">
                        <span>6:25</span>
                    </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="song-list">
            <h2>Songs</h2>
            <div class="song-list-container">
                <div class="song-case">
                    <div>
                        <h4 class="song-title">Freedom</h4>
                        <p class="author">By Saturn</p>
                    </div>
                   <div>
                    <span class="total-time-of-song">6:25</span>
                   </div>
                </div>
            
            </div>
        </div>

        <div class="modal-container">

        </div>

    </main>
    <script src="./js/main.js"></script>
    <script>

             const songsInObject = [
                {
                    imageCover: 'https://i.pinimg.com/originals/3b/8a/d2/3b8ad2c7b1be2caf24321c852103598a.jpg',
                    title:'Memories',
                    author: 'Royal Free Music | Bensound Music',
                    source: 'https://www.bensound.com/bensound-music/bensound-memories.mp3'
                },
                {
                    imageCover: 'https://c.stocksy.com/a/2am300/z9/901730.jpg',
                    title:'Better Days',
                    author: 'Royal Free Music | Bensound Music',
                    source: 'https://www.bensound.com/bensound-music/bensound-betterdays.mp3',
                    type:"audio/mpeg"
                },
                {
                    imageCover: 'https://c4.wallpaperflare.com/wallpaper/510/623/588/love-tenderness-child-small-wallpaper-preview.jpg',
                    title:'Tenderness',
                    author: 'Royal Free Music | Bensound Music',
                    source: 'https://www.bensound.com/bensound-music/bensound-tenderness.mp3',
                    type:"audio/mpeg"
                }
                ,
                {
                    imageCover: 'https://images.unsplash.com/photo-1487215078519-e21cc028cb29?ixlib=rb-1.2.1&ixid=MXwxMjA3fDB8MHxleHBsb3JlLWZlZWR8Mjd8fHxlbnwwfHx8&w=1000&q=80',
                    title:'E.R.F',
                    author: 'Benjamin Tissot',
                    source: 'https://www.bensound.com/bensound-music/bensound-erf.mp3',
                    type:"audio/mpeg"
                },
                {
                    imageCover: 'https://www.movesmedia.com/wp-content/uploads/2017/12/Music.jpg',
                    title:'Energy',
                    author: 'Anonymous',
                    source: 'https://www.bensound.com/bensound-music/bensound-energy.mp3',
                    type:"audio/mpeg"
                },
                {
                    imageCover: 'https://res.cloudinary.com/teepublic/image/private/s--11pGPf10--/c_fit,g_north_west,h_599,w_840/co_000000,e_outline:40/co_000000,e_outline:inner_fill:1/co_ffffff,e_outline:40/co_ffffff,e_outline:inner_fill:1/co_bbbbbb,e_outline:3:1000/c_mpad,g_center,h_1260,w_1260/b_rgb:eeeeee/c_limit,f_jpg,h_630,q_90,w_630/v1551800971/production/designs/4343793_2.jpg',
                    title:'Hey',
                    author: 'Royal Free Music | Bensound Music',
                    source: 'https://www.bensound.com/bensound-music/bensound-hey.mp3',
                    type:"audio/mpeg"
                }
            ]

            //built bindings
            let audio;
            let incrementDecrementValue = 0;
            let songsToDisplayArray = [];
            let playing;
            
                

            //Element Bindings
            const bar = document.querySelector("#bar");
            const barAndTimeContainer = document.querySelector('.bar-and-time-container');
            let barPosition = barAndTimeContainer.offsetLeft;

            window.addEventListener('click',function (){
                console.log(barPosition, 'bar container');
            });
            let overlay = document.getElementById("overlay");
            const title = document.querySelector('#title-main');
            const author = document.querySelector('#author-main');
            const play = document.querySelector('.play-button');
            const imageCase = document.querySelector('.image-case');
            const imageCover = document.querySelector('.song-screen');
            const currentTime = document.querySelector('#current-time'); 
            const backwardButton = document.querySelector('.backward-button');
            const forwardButton = document.querySelector('.forward-button');
            const songListContainer = document.querySelector('.song-list-container');
            const modalContainer =  document.querySelector('.modal-container');
            



            //Haburger
            const burger = document.querySelector('.burger');
            const songList = document.querySelector('.song-list');

            burger.addEventListener("click", () => {
                songList.classList.toggle("song-list-out");
            });


            let localTokenData = 'SFSIFNASFKASKLKLDGDFGDVVVV';
            window.onload = () => {
                if(localStorage.getItem('serialToken') === localTokenData){
                    modalContainer.style.display = 'none';
                    return;
                }else{
                    modalContainer.style.display = 'block';
                    modalContainer.innerHTML = `
                    <div class="modal">
                        <div class="intro-image"></div>
                        <div class="intro-details">
                            <p>version 1.0</p>
                            <p>Miplay is simply a music website that allows you to play music online.</p>
                            <div class="button-case"><button class="enter">Enter</button></div>
                        </div>
                    </div>
                    `;
                    }

                    document.querySelector('.enter').addEventListener('click', function(){
                    localStorage.setItem('serialToken', localTokenData)
                    modalContainer.style.display = 'none';
                });
            }



            const songMapToSide = () => {
            var content = '';
            for (let i = 0; i < songsInObject.length;i++) {
            content +=`
                    <div class="song-case" onclick="getThisTagValue(this)" data-id=${songsInObject[i].title.replace(/\W/g, "-")}>
                        <div>
                            <h4 class="song-title title-in-list">${songsInObject[i].title}</h4>
                            <p class="author  author-in-list">${songsInObject[i].author}</p>
                        </div>
                    <div>
                        <span class="total-time-of-song">6:25</span>
                    </div>
                    </div>`;
            }


            songListContainer.innerHTML = content;
      
            }
            songMapToSide();

            

            const titleInList = document.querySelector('.title-in-list');
            const authorInList = document.querySelector('.author-in-list');

            const getThisTagValue = (songCase) => {
                var songString = songCase.firstElementChild.firstElementChild.textContent;
                songString = songString.replace(/\s+/g, ' ').trim();
                PlayClickedSong(songString);
            }

            const PlayClickedSong = (str) => {//[_/\*&^%$#@$^*!@#$^:"~+_+]
                songsInObject.forEach((item,index) => {
                    item.title = item.title//.replace(/\s[_+]/g, ' ').trim()
                    if(item.title.includes(str)){
                        if(!audio.paused){
                            play.innerHTML = '<img src="./img/play-white.png" alt="play"/>';
                            audio.pause();
                            incrementDecrementValue = index; 
                            windowOnload(item);
                            play.innerHTML = '<img src="./img/pause-white.png" alt="pause"/>';
                            audio.play();  
                            return;
                        }else{
                            play.innerHTML = '<img src="./img/play-white.png" alt="play"/>';
                            audio.pause();
                            incrementDecrementValue = index; 
                            windowOnload(item);
                        }

                    }   
                });
            }

            
            const imageCoverFunction = (binding, url) => {
                binding.style.background = `url(${url})`;
                binding.style.backgroundPosition = 'center';
                binding.style.backgroundSize = 'cover';
                binding.style.backgroundRepeat = 'no-repeat';
            }
            
            const windowOnload = (arr) => {
                if(!arr){
                    title.textContent = songsInObject[0].title;
                    author.textContent = songsInObject[0].author;
                    //imageCoverFunction(imageCase, songsInObject[0].imageCover)
                    imageCoverFunction(imageCover, songsInObject[0].imageCover)
                    audio = new Audio(songsInObject[0].source);
                }
                else{
                title.textContent = arr.title;
                author.textContent = arr.author;
                imageCoverFunction(imageCover, arr.imageCover)
                audio = new Audio(arr.source);
                }
            }


            forwardButton.addEventListener('click', incrementToNextSong);
            backwardButton.addEventListener('click', decrementToNextSong);


            //creating an array
            const arr = (arr, value) => {
                return arr[value];
            }

            function incrementToNextSong(){
                if(!audio.paused){
                    play.innerHTML = '<img src="./img/play-white.png" alt="play"/>';
                    audio.pause();

                    incrementDecrementValue = incrementDecrementValue + 1;
                    if(songsToDisplayArray == []) songsToDisplayArray.push(arr(songsInObject,incrementDecrementValue));
                    else{
                        songsToDisplayArray.pop();
                        songsToDisplayArray.push(arr(songsInObject,incrementDecrementValue));
                    }
                    if(songsToDisplayArray[0] == undefined){
                        incrementDecrementValue = songsInObject.length-1; 
                        return;
                    }
                    windowOnload(songsToDisplayArray[0]);
                    play.innerHTML = '<img src="./img/pause-white.png" alt="pause"/>';
                    audio.play();   
                }else{
                    play.innerHTML = '<img src="./img/play-white.png" alt="play"/>';
                    audio.pause();

                    incrementDecrementValue = incrementDecrementValue + 1;
                    if(songsToDisplayArray == []) songsToDisplayArray.push(arr(songsInObject,incrementDecrementValue));
                    else{
                        songsToDisplayArray.pop();
                        songsToDisplayArray.push(arr(songsInObject,incrementDecrementValue));
                    }
                    if(songsToDisplayArray[0] == undefined){
                        incrementDecrementValue = songsInObject.length-1; 
                        return;
                    }
                    windowOnload(songsToDisplayArray[0]);
                }

                   
            }

            function decrementToNextSong(){
                    if(!audio.paused){
                            play.innerHTML = '<img src="./img/play-white.png" alt="play">';
                            audio.pause();
                            incrementDecrementValue = incrementDecrementValue - 1;
                            if(songsToDisplayArray == []) songsToDisplayArray.push(arr(songsInObject,incrementDecrementValue));
                            else{
                                songsToDisplayArray.pop();
                                songsToDisplayArray.push(arr(songsInObject,incrementDecrementValue));
                            }
                            if(songsToDisplayArray[0] == undefined){
                            incrementDecrementValue = songsInObject.indexOf(songsInObject[0]); 
                            return;
                        }
                            windowOnload(songsToDisplayArray[0]);
                            play.innerHTML = '<img src="./img/pause-white.png" alt="pause"/>';
                            audio.play();
                    }else{
                        play.innerHTML = '<img src="./img/play-white.png" alt="play">';
                            audio.pause();
                            incrementDecrementValue = incrementDecrementValue - 1;
                            if(songsToDisplayArray == []) songsToDisplayArray.push(arr(songsInObject,incrementDecrementValue));
                            else{
                                songsToDisplayArray.pop();
                                songsToDisplayArray.push(arr(songsInObject,incrementDecrementValue));
                            }
                            if(songsToDisplayArray[0] == undefined){
                            incrementDecrementValue = songsInObject.indexOf(songsInObject[0]); 
                            return;
                        }
                            windowOnload(songsToDisplayArray[0]);
                    }

                      
            }
            

                            
            //Moving Bar
            function pixelPerSecond(){// this is returning approximately 2 pixels per second
                // const val = currentAudio.duration;
                // console.log(val, 'this is val');
                return Number(window.getComputedStyle(bar).getPropertyValue("width").replace("px", "")) / audio.duration;
            }

            function currentTimeOnSync(){
            if(!window.grabbing){
                // console.log(currentAudio.currentTime); // this value keeps running and doesn't stop
                currentTime.style.width = (audio.currentTime * pixelPerSecond()) + "px";// this is what is moving the BAR.
            }
            }// Ask this question on google. How to calculate the moving bar to move with the music from beginning to the 
            // end.


            function currentGrabTimeUpdate(event){
            let eventPageX = event.pageX || event.touches[0].pageX;
            console.log(eventPageX, 'event page x');
            if((eventPageX - barPosition) > Number(window.getComputedStyle(bar).getPropertyValue("width").replace("px",""))){
                currentTime.style.width = window.getComputedStyle(bar).getPropertyValue("width");
            }else if((eventPageX - barPosition) < 0){
                currentTime.style.width = 0;
            }else{
                currentTime.style.width = (eventPageX - barPosition) + "px";
            }
            }



            //this funtion id for holding or pressing the bar
            function barStart(event){
                //console.log(event.pageX, ' event target.');
            if(event.target == bar){
                let eventPageX = event.pageX || event.touches[0].pageX;// this is not a constant value
                window.grabbing = true;
                
                currentTime.style.width = (eventPageX - barPosition) + "px";// you are moving the width of the blue container here
                //which is currentTime
                overlay.style.display = "block";//this overlay is what i dont understand
                
                if(event.type == 'touchstart'){
                window.addEventListener("touchmove", currentGrabTimeUpdate);
                }else{
                window.addEventListener("mousemove", currentGrabTimeUpdate);// this is dragging the element
                }
                audio.muted = true;
            }
            }

            function barEnd(event){
            if(window.grabbing === true){
                window.grabbing = false;
                audio.muted = false;
                audio.currentTime = Number(currentTime.style.width.replace("px","")) / pixelPerSecond();
                overlay.style.display = "none";
                
                if(event.type == 'touchstart'){
                window.removeEventListener("touchmove", currentGrabTimeUpdate);
                }else{
                window.removeEventListener("mousemove", currentGrabTimeUpdate);
                }
            }
            }


            window.addEventListener("mousedown", barStart);//this is for moving the bar when using mouse
            window.addEventListener("mouseup", barEnd);//this is for the bar when not using the mouse

            window.addEventListener("touchstart", barStart);//this is for tablet
            window.addEventListener("touchend", barEnd);//this is for tablet

                        
            (function onLoad(){
                playing = setInterval(currentTimeOnSync, 1);
                windowOnload()
            })();


            play.addEventListener('click', function(){
                if(audio.paused){
                    play.innerHTML = '<img src="./img/pause-white.png" alt="pause"/>';
                    audio.play(); 
                }else{
                    play.innerHTML = '<img src="./img/play-white.png" alt="play"/>';
                    audio.pause(); 
                }
                audio.addEventListener("ended", audioEnded);
            });


            let volumeRamge = audio.volume = 0.5;

            window.addEventListener('keydown', function(event){
                console.log(event.keyCode);
                if(event.keyCode === 32 && audio.paused){
                    play.innerHTML = '<img src="./img/pause-white.png" alt="pause"/>';
                    audio.play();
                } else if(event.keyCode === 32 && !audio.paused){
                    play.innerHTML = '<img src="./img/play-white.png" alt="play"/>';
                    audio.pause(); 
                }else if(event.keyCode === 37){
                    decrementToNextSong();  
                }else if(event.keyCode === 39){
                        incrementToNextSong();
                }else if(event.keyCode === 38){
                    audio.volume = audio.volume + 0.1;
                }else if(event.keyCode === 40){
                    audio.volume = audio.volume - 0.1;
                }
            });


            
            
            function audioEnded(){
            play.innerHTML = '<img src="./img/play-white.png" alt="play"/>';
            }
    </script>
</body>

</html>